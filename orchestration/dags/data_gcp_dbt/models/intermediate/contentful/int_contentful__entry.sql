select
    contentful_tags_id,
    contentful_tags_name,
    space,
    id,
    type,
    environment,
    content_type,
    locale,
    modules,
    display_parameters,
    venues_search_parameters,
    around_radius,
    hits_per_page,
    tags,
    venue_types,
    layout,
    additional_algolia_parameters,
    algolia_parameters,
    cover,
    categories,
    image_full_screen,
    is_digital,
    newest_only,
    price_min,
    subcategories,
    first_line,
    image,
    left_icon,
    second_line,
    target_not_connected_users_only,
    url,
    alt,
    offer_id,
    highlight_title,
    offer_image,
    safe_cast(ending_datetime as timestamp) as ending_datetime,
    safe_cast(beginning_datetime as timestamp) as beginning_datetime,
    safe_cast(is_geolocated as bool) as is_geolocated,
    safe_cast(is_duo as bool) as is_duo,
    safe_cast(is_event as bool) as is_event,
    safe_cast(is_thing as bool) as is_thing,
    safe_cast(price_max as float64) as price_max,
    safe_cast(min_offers as int64) as min_offers,
    {{ clean_str("title") }} as title,
    {{ clean_str("offer_title") }} as offer_title,
    regexp_extract(url, r'to/([^/?#]+)') as typeform_id
from {{ source("raw", "contentful_entry") }}
qualify row_number() over (partition by id order by execution_date desc) = 1


